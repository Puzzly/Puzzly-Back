<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.puzzly.api.repository.mybatis.UserMybatisRepository">
    <select id="selectUser" resultType="com.puzzly.api.dto.response.UserResponseDto">
        select tu.user_id, user_name, nick_name, email, phone_number,
               birth, gender, create_date_time, modify_date_time, delete_date_time,
               status, tue.extension_id, tue.first_term_agreement, tue.second_term_agreement,
               tue.profile_file_path, tue.status_message
        from users tu
        INNER JOIN
            user_extension tue
        ON
            tue.extension_id = tu.extension_id
        where tu.user_id = #{userId}
    </select>

    <select id="selectUserByEmail" resultType="com.puzzly.api.entity.User">
        select * from users where email = #{email}
    </select>

    <select id="selectUserByCalendar" resultType="com.puzzly.api.dto.response.UserResponseDto">
        SELECT tu.user_id, tu.user_name, tu.nick_name, tu.email, tu.phone_number, tu.gender
        FROM
            users tu
        INNER JOIN
            calendar_user_relation tcur
        ON
            tcur.user_id = tu.user_id
        where
            tcur.calendar_id = #{calendarId}
    </select>

    <select id="selectUserByCalendarContentRelation" resultType="com.puzzly.api.dto.response.UserResponseDto">
        SELECT tu.user_id, tu.user_name, tu.nick_name, tu.email, tu.phone_number, tu.gender
        FROM
            users tu
                INNER JOIN
            calendar_content_user_relation tccur
            ON
                tccur.user_id = tu.user_id
        where
            tccur.content_id = #{contentId}
        AND
            tccur.isDeleted = #{isDeleted}
    </select>

    <select id="selectUserAuthority" resultType="string">
        select account_authority
        from user_account_authority
        where user_id = #{userId}
    </select>
</mapper>